/* ===== Stacked sections ===== */
.videoSection {
  position: absolute;
  inset: 0;
  width: 100vw;
  min-height: 100vh;
  min-height: 100svh;
  min-height: 100dvh;
  overflow: hidden;
  will-change: transform, opacity;
  transform: translateZ(0);
  /* PERF: Reduced from 0.55s to 0.35s for snappier animations */
  transition:
    transform 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    opacity 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    visibility 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    box-shadow 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    filter 0.35s cubic-bezier(0.25, 0.85, 0.2, 1);
  background: transparent;
  box-shadow: none;
  z-index: 1;
  backface-visibility: hidden;
  border: none;
  outline: none;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.videoSection:first-of-type {
  box-shadow: none;
}

.videoSection[data-state="prev"] {
  /* Старт выше экрана для выезда сверху при скролле вверх */
  transform: translateY(-100%) scale(1);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  z-index: 0 !important;
  box-shadow: none;
  filter: none;
}

.videoSection[data-state="next"] {
  /* Старт заметно ниже экрана для видимого выезда */
  transform: translateY(150%) scale(0.98);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  z-index: 0;
  filter: none;
  box-shadow: none;
  will-change: transform;
}

.videoSection[data-state="idle"] {
  /* Секции, которые не являются next/prev/active - полностью скрыты, без сдвигов */
  transform: translateY(0) scale(1);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  z-index: 0 !important;
  filter: none;
  box-shadow: none;
}

.videoSection.active,
.videoSection[data-state="active"] {
  transform: translateY(0) scale(1);
  opacity: 1;
  pointer-events: auto;
  z-index: 3;
  background: #000;
  box-shadow: none;
  visibility: visible;
  /* PERF: Reduced from 0.55s to 0.35s for snappier animations */
  transition:
    transform 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    opacity 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    visibility 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    box-shadow 0.35s cubic-bezier(0.25, 0.85, 0.2, 1),
    filter 0.35s cubic-bezier(0.25, 0.85, 0.2, 1);
}

[data-direction="next"] .videoSection[data-state="next"] {
  /* Выезжает снизу вверх до финальной позиции - ПЛАВНО! */
  transform: translateY(0) scale(1);
  /* Выше предыдущей, чтобы движение было видно */
  z-index: 5;
  opacity: 1;
  visibility: visible;
  box-shadow: 0 -10px 28px rgba(0, 0, 0, 0.32);
  filter: none;
  pointer-events: none;
  transition: none;
  /* PERF: Reduced from 0.45s to 0.3s for snappier animation */
  animation: deckSlideUp 0.3s cubic-bezier(0.23, 0.9, 0.15, 1) forwards;
}

[data-direction="next"] .videoSection[data-state="prev"] {
  /* Текущая (бывшая активная) остаётся на месте, пока следующая выезжает */
  opacity: 0.92;
  visibility: visible;
  transform: translateY(0) scale(1);
  z-index: 1 !important;
  pointer-events: none;
  box-shadow: none;
  filter: brightness(0.95);
}

@keyframes deckSlideUp {
  from {
    transform: translateY(150%) scale(0.98);
    opacity: 0.65;
    box-shadow: 0 -20px 38px rgba(0, 0, 0, 0.4);
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
    box-shadow: 0 -10px 28px rgba(0, 0, 0, 0.32);
  }
}

/* Сохраняем яркость текущей секции до завершения анимации вниз */
[data-direction="next"] .videoSection[data-state="prev"] video {
  filter: brightness(1);
}

[data-direction="prev"] .videoSection[data-state="prev"] {
  /* Выезжает сверху вниз до финальной позиции */
  opacity: 1;
  visibility: visible;
  transform: translateY(0) scale(1);
  z-index: 4 !important;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  pointer-events: none;
  transition: none;
  /* PERF: Reduced from 0.45s to 0.3s for snappier animation */
  animation: deckSlideDown 0.3s cubic-bezier(0.23, 0.9, 0.15, 1) forwards;
}

@keyframes deckSlideDown {
  from {
    transform: translateY(-100%) scale(1);
    opacity: 0.65;
    box-shadow: 0 20px 38px rgba(0, 0, 0, 0.4);
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }
}

/* При пролистывании вверх текущая активная уходит вниз */
[data-direction="prev"] .videoSection[data-state="next"] {
  opacity: 1;
  visibility: visible;
  transform: translateY(100%) scale(1);
  z-index: 1 !important;
  pointer-events: none;
  box-shadow: none;
  /* PERF: Reduced from 0.45s to 0.3s for snappier animation */
  transition: transform 0.3s cubic-bezier(0.23, 0.9, 0.15, 1),
              opacity 0.3s cubic-bezier(0.23, 0.9, 0.15, 1);
}

/* Убеждаемся что секции в idle не показываются даже при direction */
[data-direction="next"] .videoSection[data-state="idle"],
[data-direction="prev"] .videoSection[data-state="idle"] {
  opacity: 0 !important;
  visibility: hidden !important;
  /* Держим на месте, чтобы предыдущая не уезжала */
  transform: translateY(0) scale(1) !important;
}

/* В idle показываем только active */
[data-direction="idle"] .videoSection[data-state="next"],
[data-direction="idle"] .videoSection[data-state="prev"] {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(100%) scale(1);
}

/* Peek-область отключена для избавления от артефактов */
.videoSection::after {
  content: none;
}

/* ===== Видео внутри секций ===== */
.videoSection video {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  /* Без затемнения для чистой анимации */
  filter: brightness(1);
  /* PERF: Reduced from 0.55s to 0.35s */
  transition: filter 0.35s cubic-bezier(0.25, 0.85, 0.2, 1);
  opacity: 1;
}

/* Показываем poster пока видео не готово */
.videoSection:not([data-video-ready="true"]) video {
  opacity: 0.7;
}

.videoSection[data-video-ready="true"] video {
  opacity: 1;
}

.videoSection.active video,
.videoSection[data-state="active"] video {
  filter: brightness(1);
}

.videoSection[data-state="next"] video {
  /* Без затемнения у выезжающей секции */
  filter: brightness(1);
}

/* ===== Кликабельный оверлей-ссылка ===== */
.sectionLink {
  position: absolute;
  inset: 0;
  z-index: 6;
  display: block;
  cursor: pointer;
  background: transparent;
}

/* ===== Подписи к секциям ===== */
.videoCaption {
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translate(-50%, 50px);
  font-family: 'Gotham', Helvetica, Arial, sans-serif;
  font-weight: 300;
  font-size: clamp(1.5rem, 4vw, 2.5rem);
  letter-spacing: 0.15em;
  color: #fff;
  text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
  pointer-events: none;
  white-space: nowrap;
  opacity: 0;
  filter: blur(10px);
  /* PERF: Reduced from 0.55s to 0.35s for faster caption appearance */
  transition:
    opacity 0.35s cubic-bezier(0.4, 0, 0.2, 1),
    transform 0.35s cubic-bezier(0.4, 0, 0.2, 1),
    filter 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

.videoSection.active .videoCaption,
.videoSection[data-state="active"] .videoCaption {
  opacity: 1;
  transform: translate(-50%, 0);
  filter: blur(0);
  /* PERF: reduced from 0.22s to 0.1s for faster caption appearance */
  transition-delay: 0.1s;
}

.videoSection[data-state="prev"] .videoCaption {
  opacity: 0;
  transform: translate(-50%, -30px);
  filter: blur(6px);
}

.videoSection[data-state="next"] .videoCaption {
  opacity: 0;
  filter: blur(8px);
}

/* CRITICAL: Active section should show caption even if it's also "next" during animation */
.videoSection[data-state="active"] .videoCaption {
  opacity: 1 !important;
  transform: translate(-50%, 0) !important;
  filter: blur(0) !important;
}

/* During deck movement we keep NON-active captions hidden; active caption can stay visible */
[data-direction="next"] .videoSection:not([data-state="active"]) .videoCaption,
[data-direction="prev"] .videoSection:not([data-state="active"]) .videoCaption,
[data-gesture="true"] .videoSection:not([data-state="active"]) .videoCaption {
  opacity: 0 !important;
  transform: translate(-50%, 22px) !important;
  filter: blur(10px) !important;
  transition-delay: 0s !important;
}

/* Активной секции разрешаем показывать подпись даже во время жеста/быстрой анимации */
[data-gesture="true"] .videoSection[data-state="active"] .videoCaption {
  opacity: 1 !important;
  transform: translate(-50%, 0) !important;
  filter: blur(0) !important;
  /* PERF: no delay during gesture for instant caption visibility */
  transition-delay: 0s;
}

/* ===== Video poster fallback ===== */
.videoPoster {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ===== Reduced motion ===== */
@media (prefers-reduced-motion: reduce) {
  .videoSection {
    will-change: auto;
    transition: none;
    transform: none !important;
  }
  
  .videoCaption,
  .videoSection video {
    transition: none;
  }

  .videoSection.active .videoCaption,
  .videoSection[data-state="active"] .videoCaption {
    transition-delay: 0s;
  }
}

/* ===== Mobile ===== */
@media (max-width: 768px) {
  .videoCaption {
    bottom: 120px;
    font-size: 1.2rem;
    letter-spacing: 0.1em;
    filter: none;
  }
  
  .videoSection {
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.3);
  }
  
  .videoSection.active .videoCaption,
  .videoSection[data-state="active"] .videoCaption {
    filter: none;
  }
}

/* ===== Safari fixes and macOS performance optimizations ===== */
@supports (-webkit-touch-callout: none) {
  .videoSection {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    height: -webkit-fill-available;
    min-height: 100vh;
    min-height: 100svh;
    /* Optimize for Safari: use transform3d for better GPU acceleration */
    transform: translate3d(0, 0, 0);
    /* Reduce will-change scope for better performance */
    will-change: transform, opacity;
    /* Improve compositing on Safari */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000px;
  }

  /* Disable will-change when not actively animating to save resources */
  .videoSection[data-state="active"]:not([data-gesture="true"]) {
    will-change: auto;
  }

  /* Optimize video elements for Safari */
  .videoSection video {
    -webkit-transform: translateZ(0);
    transform: translate3d(0, 0, 0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
}

/* ===== Touch optimizations ===== */
@media (hover: none) and (pointer: coarse) {
  .videoCaption {
    transition:
      opacity 0.6s ease,
      transform 0.8s ease;
  }
}

/* ===== Interactive gesture progress (touch / trackpad) ===== */
/* The wrapper (`Home.videoSectionsWrapper`) sets:
   - data-gesture="true|false"
   - data-direction="next|prev|idle"
   - CSS var --gesture-progress in [0..1]
*/
[data-gesture="true"] .videoSection {
  transition: none !important;
  animation: none !important;
}

[data-gesture="true"][data-direction="next"] .videoSection[data-state="next"] {
  /* Follow finger/trackpad: from below -> to center */
  transform: translateY(calc(150% * (1 - var(--gesture-progress)))) scale(
    calc(0.98 + 0.02 * var(--gesture-progress))
  ) !important;
  opacity: calc(0.65 + 0.35 * var(--gesture-progress)) !important;
  visibility: visible !important;
  z-index: 5 !important;
  pointer-events: none;
  box-shadow: 0 -10px 28px rgba(0, 0, 0, 0.32);
}

[data-gesture="true"][data-direction="next"] .videoSection[data-state="prev"] {
  /* Current stays in place, slightly dims as the next comes in */
  transform: translateY(0) scale(1) !important;
  opacity: calc(1 - 0.08 * var(--gesture-progress)) !important;
  visibility: visible !important;
  z-index: 1 !important;
  pointer-events: none;
  /* Avoid GPU-heavy full-screen filters on trackpads (causes stutter on macOS). */
  filter: none !important;
}

[data-gesture="true"][data-direction="prev"] .videoSection[data-state="prev"] {
  /* Incoming previous: from above -> to center */
  transform: translateY(calc(-100% * (1 - var(--gesture-progress)))) scale(1) !important;
  opacity: calc(0.75 + 0.25 * var(--gesture-progress)) !important;
  visibility: visible !important;
  z-index: 5 !important;
  pointer-events: none;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

[data-gesture="true"][data-direction="prev"] .videoSection[data-state="next"] {
  /* Current active moves down proportionally */
  transform: translateY(calc(100% * var(--gesture-progress))) scale(1) !important;
  opacity: calc(1 - 0.08 * var(--gesture-progress)) !important;
  visibility: visible !important;
  z-index: 1 !important;
  pointer-events: none;
  /* Avoid GPU-heavy full-screen filters on trackpads (causes stutter on macOS). */
  filter: none !important;
}
